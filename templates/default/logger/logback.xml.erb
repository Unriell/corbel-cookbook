<configuration>

  <% if @config[:file][:enabled] -%>
    <appender name="FILE" class="ch.qos.logback.core.rolling.RollingFileAppender">
      <file><%= @config[:file][:currentLogFilename] %></file>
      <encoder>
        <pattern>%level [%date{ISO8601}] %X{requestId} %logger{35} - %msg%n</pattern>
      </encoder>
      <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
        <level><%= @config[:file][:level] %></level>
      </filter>
      <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
        <fileNamePattern><%= @config[:file][:archivedLogFilenamePattern] %></fileNamePattern>
        <maxHistory>15</maxHistory>
      </rollingPolicy>
    </appender>
  <% end -%>

  <% if @config[:syslog][:enabled] -%>
    <appender name="SYSLOG" class="ch.qos.logback.classic.net.SyslogAppender">
      <filter class="ch.qos.logback.classic.filter.ThresholdFilter">
        <level><%= @config[:syslog][:level] %></level>
      </filter>
      <syslogHost>localhost</syslogHost>
      <facility>USER</facility>
      <suffixPattern>%level [%date{ISO8601}] %X{requestId} %logger{35} - %msg%n</suffixPattern>
    </appender>
  <% end -%>

  <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
      <pattern>%level [%date{ISO8601}] %X{requestId} %logger{35} - %msg%n</pattern>
    </encoder>
  </appender>

  <root level="<%= @config[:root][:level] %>">
    <% if @config[:file][:enabled] -%>
      <appender-ref ref="FILE" />
    <% end -%>
    <% if @config[:syslog][:enabled] -%>
      <appender-ref ref="SYSLOG" />
    <% end -%>
    <appender-ref ref="STDOUT" />
  </root>

</configuration>
